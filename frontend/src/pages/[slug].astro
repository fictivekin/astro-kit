---
import Layout from "@/layouts/Layout.astro";
import SectionRenderer from "@/components/SectionRenderer.astro";
import { getCollection, getEntry } from "astro:content";

export const prerender = true;

// Get all pages for static generation
export async function getStaticPaths() {
  const pages = await getCollection("pages");

  return pages.map((page: any) => ({
    params: { slug: page.id },
  }));
}

const { slug } = Astro.params;

const pageEntry = await getEntry("pages", slug);

// Return 404 if page not found
if (!pageEntry) {
  return Astro.redirect("/404");
}

const page = pageEntry.data;
---

<Layout
  title={page?.seoTitle || page?.title || undefined}
  description={page?.seoDescription || undefined}
  keywords={page?.seoKeywords || undefined}
  noIndex={page?.noIndex ?? undefined}
  image={page?.socialImage?.asset?.url || undefined}
  imageAlt={page?.socialImageAlt || page?.socialImage?.altText || undefined}
>
  <SectionRenderer sections={page?.sections} />
</Layout>
