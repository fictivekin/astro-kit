---
import Layout from "../layouts/Layout.astro";
import { sanityClient } from "../lib/sanity";
import Hero from "../components/Hero/Hero.astro";
import Headline from "../components/Headline/Headline.astro";

// Component mapping
const componentMap: Record<string, any> = {
  hero: Hero,
  headline: Headline,
  // Add more components here as you create them
};

// Query the homepage from Sanity
const homepage = await sanityClient.fetch(
  `*[_type == "page" && _id == "homepage"][0] {
        ...,
        "slug": select(
            _id == "homepage" => "homepage",
            _id == "notFoundPage" => "404",
            slug.current
        ),
        "sections": sections[] {
            _type == 'linkedSection' || _type == 'reference' => @->,
            _type != 'inkedSection' => @,

            _type == 'reference' => {
                // Hoist the referenced module's _type value
                // Used by DynamicComponent, et al
                "_type": @->_type,
            },
        }{
            ...,
						_type == "hero" => {
							eyebrow,
							title,
						},
            _type == "headline" => {
              eyebrow,
              title,
              body,
              textAlignment
            }
        },
        noIndex
    }`
);
---

<Layout>
  {
    homepage?.sections?.map((section: any) => {
      const Component = componentMap[section._type];

      if (Component) {
        return <Component {...{ [section._type]: section }} />;
      }

      // Fallback for sections without a component
      return <div>No component for: {section._type}</div>;
    })
  }
</Layout>
